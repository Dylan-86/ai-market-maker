<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AI Market Maker</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="layout">
    <!-- LEFT COLUMN: Chat -->
    <div class="chat-column">
      <h1>AI Market Maker</h1>
      <div class="chat-box" id="chatHistory"></div>
      <div class="chat-input">
        <input type="text" id="userInput" placeholder="Type your question...">
        <button id="btnGenerate">Send</button>
      </div>
    </div>

    <!-- RIGHT COLUMN: Parsed Data -->
    <div class="data-column">
      <h2>Parsed Output</h2>
      <div class="parsed-data">
        <div><strong>Title:</strong><p id="title"></p></div>
        <div><strong>Description:</strong><p id="description"></p></div>
        <div><strong>Underlying Metric:</strong><p id="underlyingMetric"></p></div>
        <div><strong>URL:</strong><p id="url"></p></div>
        <div><strong>Score:</strong><p id="score"></p></div>
        <div><strong>Reason:</strong><p id="reason"></p></div>
      </div>
    </div>
  </div>

  <script>
    async function getAIResponse() {
      const userInput = document.getElementById("userInput").value.trim();
      if (!userInput) return;

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user_input: userInput })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Server error");

        const chatHistoryDiv = document.getElementById("chatHistory");
        const userMsg = document.createElement("div");
        userMsg.className = "message user";
        userMsg.textContent = userInput;
        chatHistoryDiv.appendChild(userMsg);

        const aiMsg = document.createElement("div");
        aiMsg.className = "message ai";
        aiMsg.textContent = data.generated_text || "No response.";
        chatHistoryDiv.appendChild(aiMsg);

        document.getElementById("title").textContent = data.title || "";
        document.getElementById("description").textContent = data.description || "";
        document.getElementById("underlyingMetric").textContent = data.underlying_metric || "";
        document.getElementById("url").textContent = data.url || "";
        document.getElementById("score").textContent = data.score || "";
        document.getElementById("reason").textContent = data.reason || "";

        chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
        document.getElementById("userInput").value = "";

      } catch (err) {
        console.error(err);
        alert("Network error");
      }
    }

    document.getElementById("btnGenerate").addEventListener("click", getAIResponse);
    document.getElementById("userInput").addEventListener("keypress", e => {
      if (e.key === "Enter") getAIResponse();
    });
  </script>
</body>
</html>
