<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI Market Maker</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>AI Market Maker</h1>

    <label for="userInput">Enter your idea:</label><br>
    <input type="text" id="userInput" name="userInput"><br><br>
    <button id="btnGenerate">Send Message</button><br><br>

    <div class="chat-history-section">
      <strong>Chat History:</strong>
      <div id="chatHistory"></div>
    </div>

    <div class="output-section">
      <strong>Last Generated Text:</strong>
      <pre id="generatedText"></pre>
    </div>

    <div class="output-section">
      <strong>Title:</strong>
      <p id="title"></p>
    </div>

    <div class="output-section">
      <strong>Description:</strong>
      <p id="description"></p>
    </div>

    <div class="output-section">
      <strong>Underlying Metric:</strong>
      <p id="underlyingMetric"></p>
    </div>

    <div class="output-section">
      <strong>URL:</strong>
      <p id="url"></p>
    </div>

    <div class="output-section">
      <strong>Score:</strong>
      <p id="score"></p>
    </div>

    <div class="output-section">
      <strong>Reason:</strong>
      <p id="reason"></p>
    </div>
  </div>

  <script>
    async function getAIResponse() {
      const userInput = document.getElementById("userInput").value.trim();
      if (!userInput) return;

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user_input: userInput })
        });
        const data = await res.json();

        if (!res.ok) {
          console.error(data);
          alert(data.error || "Server error");
          return;
        }

        // Display chat history
        const chatHistoryDiv = document.getElementById("chatHistory");
        chatHistoryDiv.innerHTML = ""; // Clear previous history
        if (data.chat_history) {
          data.chat_history.forEach(message => {
            const p = document.createElement("p");
            p.textContent = `${message.role}: ${message.text}`;
            chatHistoryDiv.appendChild(p);
          });
        }

        document.getElementById("generatedText").textContent = data.generated_text || "";
        document.getElementById("title").textContent = data.title || "";
        document.getElementById("description").textContent = data.description || "";
        document.getElementById("underlyingMetric").textContent = data.underlying_metric || "";
        document.getElementById("url").textContent = data.url || "";
        document.getElementById("score").textContent = data.score || "";
        document.getElementById("reason").textContent = data.reason || "";

        document.getElementById("userInput").value = ""; // Clear input after sending

      } catch (e) {
        console.error(e);
        alert("Network error");
      }
    }

    document.getElementById("btnGenerate").addEventListener("click", getAIResponse);
  </script>
</body>
</html>
